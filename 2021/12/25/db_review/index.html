<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
  name="viewport"
/>
<title>
   数据库原理复习（考前救急专用） 
</title>
<link rel="icon" href="/img/favicon.ico" />

<link rel="stylesheet" href="/css/style.css">
 
<link rel="stylesheet" href="/css/font-awesome.min.css">
 
<link rel="stylesheet" href="/css/gitment.css">
 
<link rel="stylesheet" href="/css/hljs.min.css">
 
<script src="/js/hljs.min.js"></script>
 
<script src="/js/gitment.browser.js"></script>


<meta name="generator" content="Hexo 5.3.0"></head>
<body>
    <header class="header" id="header">
    <h1>
        <a class="title" href="/">
            baobao
        </a>
    </h1>
    <h2>
        <a class="motto">
            DO WHAT EXCITES!
        </a>
    </h2>
    <nav class="navbar">
        <ul class="menu">
            
            
                <li class="menu-item">
                    <a href="/" class="menu-item-link">
                        Home
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/archives/" class="menu-item-link">
                        Archives
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/about/" class="menu-item-link">
                        About
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="https://github.com/thisisbadBao/" class="menu-item-link">
                        Github
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/atom.xml" class="menu-item-link">
                        RSS
                    </a>
                </li>
            
                
            
                
                
                <li class="menu-item">
                    <a class="menu-item-link search">
                        Search                   
                        <i class="fa fa-long-arrow-right search-icon" aria-hidden="true"></i>
                    </a>
                        <input placeholder="Search..." class="search-input" style="display:none;border:none!important;" onkeydown="onEnter(event)" onkeypress="onEnter(event)"></input>
                </li>
                
        </ul>
    </nav>
</header>
    <main class="main">
        <article class="post">
  <h1>
    <a class="title" href="/2021/12/25/db_review/"> 数据库原理复习（考前救急专用） </a>
  </h1>
              <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2021-12-25   
                </a>
                
                
                
                <a class="tag">
                    <i class="fa fa-tags" aria-hidden="true"></i>  
                </a>
                
                    <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/DBMS/" rel="tag">DBMS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A4%8D%E4%B9%A0/" rel="tag">复习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>
            </div> <div class="toc">
  <ol class="toc-list"><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#Chapter-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E5%BC%95%E8%AE%BA"><span class="toc-list-text">Chapter 1 数据库系统引论</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-list-text">简介</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-P2-5"><span class="toc-list-text">数据库基本概念 P2-5</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%89%E7%BA%A7%E6%A8%A1%E5%BC%8F%E4%B8%8E%E4%B8%A4%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%8B%AC%E7%AB%8B%E6%80%A7-P-7-9"><span class="toc-list-text">数据库三级模式与两级数据独立性 P 7-9</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%84%E6%88%90%E4%B8%8E%E7%94%9F%E5%91%BD%E6%9C%9F-P10"><span class="toc-list-text">数据库系统的组成与生命期 P10</span></a></li></ol></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#Chapter-2-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-list-text">Chapter 2 数据模型</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%B1%82%E6%AC%A1%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-P12-17"><span class="toc-list-text">层次数据模型 P12-17</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E7%BD%91%E7%8A%B6%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-P17-21"><span class="toc-list-text">网状数据模型 P17-21</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%EF%BC%88%E9%87%8D%E5%88%92%E7%82%B9%EF%BC%89P21-25"><span class="toc-list-text">关系数据模型（重划点）P21-25</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%85%B3%E7%B3%BB%E4%BB%A3%E6%95%B0%EF%BC%88Realtional-Algebra%EF%BC%89P25-29"><span class="toc-list-text">关系代数（Realtional Algebra）P25-29</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%85%B3%E7%B3%BB%E6%BC%94%E7%AE%97%EF%BC%88Relational-Calculus%EF%BC%89P29-30"><span class="toc-list-text">关系演算（Relational Calculus）P29-30</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BB%B7-P30-33"><span class="toc-list-text">传统数据模型评价 P30-33</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#ER%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E5%92%8C%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B-P33-44"><span class="toc-list-text">ER数据模型和面向对象数据模型 P33-44</span></a></li></ol></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#Chapter-3-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%AD%E8%A8%80SQL"><span class="toc-list-text">Chapter 3 数据库语言SQL</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#SQL%E7%AE%80%E4%BB%8B-P56-57"><span class="toc-list-text">SQL简介 P56-57</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80"><span class="toc-list-text">查询语言</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84-P62-63"><span class="toc-list-text">查询语句基本结构 P62-63</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5-P63-64"><span class="toc-list-text">简单查询语句 P63-64</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E5%9F%BA%E4%BA%8E%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5-P69"><span class="toc-list-text">基于集合操作的查询语句 P69</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E5%9F%BA%E4%BA%8E%E5%B5%8C%E5%A5%97%E5%AD%90%E6%9F%A5%E8%AF%A2%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5-P66-67"><span class="toc-list-text">基于嵌套子查询的查询语句 P66-67</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E9%99%A4%E6%B3%95%E4%B8%8E%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0%E8%AE%A1%E7%AE%97-P66"><span class="toc-list-text">除法与聚集函数计算 P66</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E5%88%86%E7%BB%84%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0%E8%AE%A1%E7%AE%97-P68-69"><span class="toc-list-text">分组聚集函数计算 P68-69</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#CAST%E4%B8%8ECASE%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-list-text">CAST与CASE表达式</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E6%A0%87%E9%87%8F%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-list-text">标量子查询</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%8E%E5%85%AC%E5%85%B1%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-list-text">表表达式与公共表表达式</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E9%80%92%E5%BD%92%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-list-text">递归子查询</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E8%A8%80-P69-71"><span class="toc-list-text">数据操纵语言 P69-71</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%85%B3%E4%BA%8E%E8%A7%86%E5%9B%BE-P72-75"><span class="toc-list-text">关于视图 P72-75</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8FSQL-P75-79"><span class="toc-list-text">嵌入式SQL P75-79</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%8A%A8%E6%80%81SQL%E4%B8%8E%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-P79-82"><span class="toc-list-text">动态SQL与存储过程 P79-82</span></a></li></ol></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#Chapter-4-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="toc-list-text">Chapter 4 数据库管理系统</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#DBMS%E6%A0%B8%E5%BF%83%E7%9A%84%E6%A8%A1%E5%9D%97%E7%BB%93%E6%9E%84-P88-90"><span class="toc-list-text">DBMS核心的模块结构 P88-90</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#DBMS%E8%BF%9B%E7%A8%8B%E7%BB%93%E6%9E%84"><span class="toc-list-text">DBMS进程结构</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BF%E9%97%AE%E7%AE%A1%E7%90%86-P101-111"><span class="toc-list-text">数据库访问管理 P101-111</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-list-text">查询优化</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%81%A2%E5%A4%8D%E6%9C%BA%E5%88%B6"><span class="toc-list-text">恢复机制</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6-P148-153"><span class="toc-list-text">并发控制 P148-153</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%8A%A0%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-list-text">加锁协议</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%AD%BB%E9%94%81%E4%B8%8E%E6%B4%BB%E9%94%81-P156-159"><span class="toc-list-text">死锁与活锁 P156-159</span></a></li></ol></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#Chapter-5-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%89%E5%85%A8%E4%B8%8E%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-list-text">Chapter 5 数据库的安全与完整性约束</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%89%E5%85%A8"><span class="toc-list-text">数据库的安全</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="toc-list-text">完整性约束</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-list-text">触发器</span></a></li></ol></li><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#Chapter-6-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-list-text">Chapter 6 数据库设计</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%95%B0%E6%8D%AE%E4%BE%9D%E8%B5%96"><span class="toc-list-text">数据依赖</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%A7%84%E8%8C%83%E5%8C%96"><span class="toc-list-text">关系模式的规范化</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="toc-list-text">解决方法</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B"><span class="toc-list-text">数据库设计流程</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%90%84%E9%98%B6%E6%AE%B5%E4%B8%BB%E8%A6%81%E5%B7%A5%E4%BD%9C"><span class="toc-list-text">各阶段主要工作</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-list-text">总结</span></a></li></ol></li></ol>
</div>
  <div class="content"><h1 id="Chapter-1-数据库系统引论"><a href="#Chapter-1-数据库系统引论" class="headerlink" title="Chapter 1 数据库系统引论"></a>Chapter 1 数据库系统引论</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>主要参考的是王能斌老师编写的《数据库系统教程》第二版上册，每个标题旁边是对应书上的页码。    </p>
<p><del>可恶啊，这学期数据库没怎么听课，还有三天就期末考了，我能补回来吗？</del></p>
<a id="more"></a>

<h2 id="数据库基本概念-P2-5"><a href="#数据库基本概念-P2-5" class="headerlink" title="数据库基本概念 P2-5"></a>数据库基本概念 P2-5</h2><p>数据库：A very large, integrated collection of data.</p>
<p>DBMS：A software package designed to store and manage databases.</p>
<ul>
<li>文件系统vs数据库<ul>
<li>应用程序需要在主存和外存中存储大量数据</li>
<li>对不同的查询有专属的代码</li>
<li>确保数据不会因为多并发用户而产生不一致性</li>
<li>对于崩溃的恢复</li>
<li>安全和访问的控制</li>
</ul>
</li>
</ul>
<p>数据库系统特点：P6-7</p>
<h2 id="数据库三级模式与两级数据独立性-P-7-9"><a href="#数据库三级模式与两级数据独立性-P-7-9" class="headerlink" title="数据库三级模式与两级数据独立性 P 7-9"></a>数据库三级模式与两级数据独立性 P 7-9</h2><ul>
<li><p>数据(Data)：对事物描述的符号记录</p>
</li>
<li><p>数据模型(Data Model)：用来描述数据的一组概念和定义</p>
</li>
<li><p>数据模式(Data Schema)：对某一类数据的结构、联系和约束的描述</p>
</li>
</ul>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211225212857.png" alt="image-20211225162834379" style="zoom:30%;" />

<ul>
<li>应用程序应该独立于数据是如何组织和存储的<ul>
<li>逻辑独立性：Protection from changes in <em>logical</em> structure of data.</li>
<li>物理独立性：Protection from changes in <em>physical</em> structure of data.</li>
</ul>
</li>
</ul>
<h2 id="数据库系统的组成与生命期-P10"><a href="#数据库系统的组成与生命期-P10" class="headerlink" title="数据库系统的组成与生命期 P10"></a>数据库系统的组成与生命期 P10</h2><ul>
<li>组成</li>
</ul>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211225212905.png" alt="image-20211225162853588" style="zoom:30%;" />

<ul>
<li>生命周期<ul>
<li>数据库系统规划</li>
<li>数据库设计</li>
<li>数据库建立</li>
<li>数据库运行、管理和维护</li>
<li>数据库的扩充和重构</li>
</ul>
</li>
</ul>
<h1 id="Chapter-2-数据模型"><a href="#Chapter-2-数据模型" class="headerlink" title="Chapter 2 数据模型"></a>Chapter 2 数据模型</h1><h2 id="层次数据模型-P12-17"><a href="#层次数据模型-P12-17" class="headerlink" title="层次数据模型 P12-17"></a>层次数据模型 P12-17</h2><ul>
<li>Basic idea:<ul>
<li>记录（record）和字段（field）</li>
<li>Parent-Child relationship</li>
<li>虚拟记录<ul>
<li>大量指针增加数据库开销，数据模式不够清晰、直观</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="网状数据模型-P17-21"><a href="#网状数据模型-P17-21" class="headerlink" title="网状数据模型 P17-21"></a>网状数据模型 P17-21</h2><ul>
<li>Basic idea:<ul>
<li>记录和数据项（data items）</li>
<li>系（set）</li>
</ul>
</li>
</ul>
<h2 id="关系数据模型（重划点）P21-25"><a href="#关系数据模型（重划点）P21-25" class="headerlink" title="关系数据模型（重划点）P21-25"></a>关系数据模型（重划点）P21-25</h2><ul>
<li><p>基本数据结构：表（或者说是一种关系），可以用严格的数学方法来研究。</p>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211225212910.png" alt="image-20211225192821308" style="zoom:30%;" />



<ul>
<li>软连接：</li>
</ul>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211226101209.png" alt="image-20211225193445171" style="zoom:50%;" />
</li>
<li><p>关系</p>
<ul>
<li>相当于一个表（table），包含多个元组</li>
<li>关系R的schema：$R=(A_{1}, A_{2},…,A_{n})$，其中A是属性名，n为关系的目（degree）。</li>
</ul>
</li>
<li><p>键</p>
<ul>
<li>候选键（candidate key）可以<strong>由一个或多个属性</strong>构成，简称键。</li>
<li>至少一个候选键，选择一个作为<strong>主键（primarykey）</strong>，其他候选键为补键（alternate key）</li>
<li>超键（super key），至少包含一个键的属性组（{学号、出生年月}）</li>
<li>全键（all key），主键由所有属性构成</li>
<li>主属性和非主属性</li>
<li>外键（foreign key），一个逻辑指针，指向另一个表中的元组</li>
</ul>
</li>
<li><p>完整性约束：语意施加在数据上的限制（只有在数据库更新是检查完整性约束）</p>
<ul>
<li>域完整性约束：在域中</li>
<li>实体完整性约束：有不为空的主键</li>
<li>引用完整性约束：对应外键的元组相等或不存在</li>
<li>一般性完整性约束：所有约束</li>
</ul>
</li>
</ul>
<h2 id="关系代数（Realtional-Algebra）P25-29"><a href="#关系代数（Realtional-Algebra）P25-29" class="headerlink" title="关系代数（Realtional Algebra）P25-29"></a>关系代数（Realtional Algebra）P25-29</h2><ul>
<li><p>选择操作（selection）：选取某些行</p>
</li>
<li><p>投影操作（projection）：选取某些列（产生重复元组） </p>
</li>
<li><p>集合操作（cross-product）：并、差、交（要满足并兼容，目、域都相同）</p>
<ul>
<li>笛卡尔乘积（不必并兼容）：所有元组各种可能的组合</li>
</ul>
</li>
<li><p>连接操作（join operation）：只连接满足条件的，没有条件的话就是笛卡尔（如不说明，就是自然连接，会消除冗余的等连接）</p>
</li>
<li><p>除操作（division）：</p>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211225212917.png" alt="image-20211225203527970" style="zoom:50%;" />
</li>
<li><p>外连接（outer join）：左，右，全</p>
<ul>
<li>与连接的区别在于外连接会保留非匹配元组，空缺部分填NULL</li>
</ul>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211225212921.png" alt="image-20211225203740154" style="zoom:30%;" />
</li>
<li><p>外并（outer union）：不用并兼容，无属性的话补NULL</p>
</li>
</ul>
<h2 id="关系演算（Relational-Calculus）P29-30"><a href="#关系演算（Relational-Calculus）P29-30" class="headerlink" title="关系演算（Relational Calculus）P29-30"></a>关系演算（Relational Calculus）P29-30</h2><ul>
<li>元组关系演算（Tuple Relational Calculus）<ul>
<li><img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211225212925.png" alt="image-20211225205159410" style="zoom:50%;" /></li>
</ul>
</li>
<li>域关系演算（Domain Relational Calculus）<ul>
<li><img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211225212928.png" alt="image-20211225205647752" style="zoom:30%;" />

</li>
</ul>
</li>
</ul>
<h2 id="传统数据模型评价-P30-33"><a href="#传统数据模型评价-P30-33" class="headerlink" title="传统数据模型评价 P30-33"></a>传统数据模型评价 P30-33</h2><ul>
<li>层次、网状、关系数据模型都是传统数据模型<ul>
<li>适用于OLTP(On-Line Transaction Processing)</li>
<li>以记录为基础，不能更好的面向用户和应用</li>
<li>不能用一种很自然的模式表达实体之间的关系</li>
<li>缺少语义信息</li>
<li>数据类型少，很难满足应用的需求</li>
</ul>
</li>
</ul>
<h2 id="ER数据模型和面向对象数据模型-P33-44"><a href="#ER数据模型和面向对象数据模型-P33-44" class="headerlink" title="ER数据模型和面向对象数据模型 P33-44"></a>ER数据模型和面向对象数据模型 P33-44</h2><ul>
<li><p>ER实体：现实世界中可以和其他物体区分的物体，用一组<strong>属性</strong>来描述</p>
</li>
<li><p>实体集（Entity Set）：相似实体的集合（例子：所有员工）</p>
</li>
<li><p>ER图P37-39</p>
<ul>
<li>弱实体（不能单独存在）</li>
<li>特殊化和普遍化</li>
<li>聚集</li>
<li>范畴</li>
</ul>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211226113603.png" alt="image-20211226113554168" style="zoom:50%;" />



<p>（这部分应该不会考很多吧，我就先不看了）</p>
</li>
</ul>
<p><del>今天又摸了半天鱼，晚安</del></p>
<h1 id="Chapter-3-数据库语言SQL"><a href="#Chapter-3-数据库语言SQL" class="headerlink" title="Chapter 3 数据库语言SQL"></a>Chapter 3 数据库语言SQL</h1><h2 id="SQL简介-P56-57"><a href="#SQL简介-P56-57" class="headerlink" title="SQL简介 P56-57"></a>SQL简介 P56-57</h2><ul>
<li><p>Structured Query Language(or Standard Query Language)</p>
</li>
<li><p>一种非过程语言，用户不需要说明如何获取数据，而只用说需要什么数据</p>
</li>
<li><p>四个功能</p>
<ul>
<li>用来定义、删除或者改变数据模式（Data Definition Language）</li>
<li>用来取数据（Query language）<code>本章重点</code></li>
<li>用来插入、删除或者更新数据（Data Manipulation Language）<code>本章重点</code></li>
<li>用来控制用户访问数据的权限（Data Control Language）</li>
</ul>
</li>
<li><p>基本概念</p>
<ul>
<li>基表：数据显示地存在数据库中</li>
<li>视图：虚表</li>
</ul>
</li>
</ul>
<h2 id="查询语言"><a href="#查询语言" class="headerlink" title="查询语言"></a>查询语言</h2><h3 id="查询语句基本结构-P62-63"><a href="#查询语句基本结构-P62-63" class="headerlink" title="查询语句基本结构 P62-63"></a>查询语句基本结构 P62-63</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">DISTINCT</span>] target<span class="operator">-</span>list  <span class="operator">/</span><span class="operator">/</span><span class="keyword">DISTINCT</span>，消除重复元组</span><br><span class="line"><span class="keyword">FROM</span>   	relation<span class="operator">-</span>list   <span class="operator">/</span><span class="operator">/</span>关系列表</span><br><span class="line"><span class="keyword">WHERE</span>   qualification    <span class="operator">/</span><span class="operator">/</span>条件</span><br></pre></td></tr></table></figure>
<p><strong>执行顺序：</strong> FROM   WHERE   GROUP BY   HAVING   SELECT   ORDER BY<em>（重要！）</em></p>
<h3 id="简单查询语句-P63-64"><a href="#简单查询语句-P63-64" class="headerlink" title="简单查询语句 P63-64"></a>简单查询语句 P63-64</h3><ul>
<li><p>后面的例子需要用到的表</p>
<img src="/Users/thisisbadbao/Library/Application Support/typora-user-images/image-20211226170440441.png" alt="image-20211226170440441" style="zoom:35%;" />
</li>
<li><p>范围变量（Range Variables）<code>AS</code></p>
<ul>
<li>就是给<code>FROM</code>后的表取别名</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>正常写法</span><br><span class="line"><span class="keyword">SELECT</span> sname</span><br><span class="line"><span class="keyword">FROM</span> Sailors, Reserves</span><br><span class="line"><span class="keyword">WHERE</span> Sailors.sid<span class="operator">=</span>Reserves.sid <span class="keyword">AND</span> bid<span class="operator">=</span><span class="number">103</span></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>取别名</span><br><span class="line"><span class="keyword">SELECT</span> S.sname</span><br><span class="line"><span class="keyword">FROM</span> Sailors S, Reserves R</span><br><span class="line"><span class="keyword">WHERE</span> S.sid<span class="operator">=</span>R.sid <span class="keyword">AND</span> bid<span class="operator">=</span><span class="number">103</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>使用表达式 <code>=</code> <code>AS</code> <code>LIKE</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> S.age, age1<span class="operator">=</span>S.age<span class="number">-5</span>, <span class="number">2</span><span class="operator">*</span>S.age <span class="keyword">AS</span> age2  <span class="operator">/</span><span class="operator">/</span><span class="keyword">AS</span>和’<span class="operator">=</span>‘一样，</span><br><span class="line"><span class="keyword">FROM</span> Sailors S  </span><br><span class="line"><span class="keyword">WHERE</span> S.sname <span class="keyword">LIKE</span> ‘B_<span class="operator">%</span>B’ <span class="operator">/</span><span class="operator">/</span><span class="string">&#x27;_&#x27;</span>表示任意一个字符，<span class="string">&#x27;%&#x27;</span>表示零个及以上个任意字符</span><br></pre></td></tr></table></figure>
<h3 id="基于集合操作的查询语句-P69"><a href="#基于集合操作的查询语句-P69" class="headerlink" title="基于集合操作的查询语句 P69"></a>基于集合操作的查询语句 P69</h3><ul>
<li><p>用集合的并集和交集</p>
<ul>
<li><code>UNION</code>  相当于<code>OR</code></li>
<li><code>UNION ALL</code> 表示将所有元组并起来，包括那些重复项，<code>UNION</code>则会去除重复项</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>找出预定过红船或绿船的水手</span><br><span class="line"><span class="keyword">SELECT</span> S.sid</span><br><span class="line"><span class="keyword">FROM</span> Sailors S, Boats B, Reserves R </span><br><span class="line"><span class="keyword">WHERE</span> S.sid<span class="operator">=</span>R.sid <span class="keyword">AND</span> R.bid<span class="operator">=</span>B.bid <span class="keyword">AND</span> B.color<span class="operator">=</span>‘red’</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> S.sid</span><br><span class="line"><span class="keyword">FROM</span> Sailors S, Boats B, Reserves R </span><br><span class="line"><span class="keyword">WHERE</span> S.sid<span class="operator">=</span>R.sid <span class="keyword">AND</span> R.bid<span class="operator">=</span>B.bid <span class="keyword">AND</span> B.color<span class="operator">=</span>‘green’</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> S.sid</span><br><span class="line"><span class="keyword">FROM</span> Sailors S,Boats B,Reserves R </span><br><span class="line"><span class="keyword">WHERE</span> S.sid<span class="operator">=</span>R.sid <span class="keyword">AND</span> R.bid<span class="operator">=</span>B.bid <span class="keyword">AND</span> (B.color<span class="operator">=</span>‘red’ <span class="keyword">OR</span> B.color<span class="operator">=</span>‘green’)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>INTERSECT</code> 相当于 <code>AND</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>找出同时预定红船和绿船的水手</span><br><span class="line"><span class="keyword">SELECT</span> S.sid</span><br><span class="line"><span class="keyword">FROM</span> Sailors S, Boats B, Reserves R </span><br><span class="line"><span class="keyword">WHERE</span> S.sid<span class="operator">=</span>R.sid <span class="keyword">AND</span> R.bid<span class="operator">=</span>B.bid <span class="keyword">AND</span> B.color<span class="operator">=</span>‘red’</span><br><span class="line"><span class="keyword">INTERSECT</span></span><br><span class="line"><span class="keyword">SELECT</span> S.sid</span><br><span class="line"><span class="keyword">FROM</span> Sailors S, Boats B, Reserves R </span><br><span class="line"><span class="keyword">WHERE</span> S.sid<span class="operator">=</span>R.sid <span class="keyword">AND</span> R.bid<span class="operator">=</span>B.bidAND B.color<span class="operator">=</span>‘green’</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> S.sid</span><br><span class="line"><span class="keyword">FROM</span> Sailors S, Boats B1, Reserves R1, Boats B2, Reserves R2</span><br><span class="line"><span class="keyword">WHERE</span> S.sid<span class="operator">=</span>R1.sid <span class="keyword">AND</span> R1.bid<span class="operator">=</span>B1.bid <span class="keyword">AND</span> S.sid<span class="operator">=</span>R2.sid <span class="keyword">AND</span> R2.bid<span class="operator">=</span>B2.bid <span class="keyword">AND</span> (B1.color<span class="operator">=</span>‘red’ <span class="keyword">AND</span></span><br><span class="line">B2.color<span class="operator">=</span>‘green’)</span><br></pre></td></tr></table></figure>
<h3 id="基于嵌套子查询的查询语句-P66-67"><a href="#基于嵌套子查询的查询语句-P66-67" class="headerlink" title="基于嵌套子查询的查询语句 P66-67"></a>基于嵌套子查询的查询语句 P66-67</h3></li>
<li><p>Nested Queries</p>
<ul>
<li><p>就是在<code>FROM</code> <code>WHERE</code> <code>SELECT</code> 中也可以用sql查询  <code>IN</code> <code>NOT IN</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>查找预定过<span class="number">103</span>号船的水手，如果用`<span class="keyword">NOT</span> <span class="keyword">IN</span>`就表示没预定过<span class="number">103</span></span><br><span class="line"><span class="keyword">SELECT</span> S.sname</span><br><span class="line"><span class="keyword">FROM</span> SailorsS</span><br><span class="line"><span class="keyword">WHERE</span> S.sid <span class="keyword">IN</span> (<span class="keyword">SELECT</span> R.sid    <span class="operator">/</span><span class="operator">/</span>意思是这个值在选出来的表中</span><br><span class="line">								<span class="keyword">FROM</span> ReservesR</span><br><span class="line">  							<span class="keyword">WHERE</span> R.bid<span class="operator">=</span><span class="number">103</span>)</span><br><span class="line">  							</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> `(<span class="keyword">NOT</span>)<span class="keyword">IN</span>` 也可以用 `(<span class="keyword">NOT</span>)<span class="keyword">EXISTS</span>`代替，写法略有不同</span><br><span class="line"><span class="keyword">SELECT</span> S.sname</span><br><span class="line"><span class="keyword">FROM</span> Sailors S</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="operator">*</span>     <span class="operator">/</span><span class="operator">/</span>意思应该是存在这样的元组</span><br><span class="line">							<span class="keyword">FROM</span> ReservesR</span><br><span class="line">   						<span class="keyword">WHERE</span> R.bid<span class="operator">=</span><span class="number">103</span> <span class="keyword">AND</span> S.sid<span class="operator">=</span>R.sid)</span><br><span class="line">   						</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>如果要查找只预定过一次<span class="number">103</span>这艘船的水手名字呢？</span><br><span class="line"><span class="keyword">SELECT</span> S.sname</span><br><span class="line"><span class="keyword">FROM</span> Sailors S</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="operator">*</span>     </span><br><span class="line">							<span class="keyword">FROM</span> Reserves R</span><br><span class="line">   						<span class="keyword">WHERE</span> R.bid<span class="operator">=</span><span class="number">103</span> <span class="keyword">AND</span> S.sid<span class="operator">=</span>R.sid)</span><br><span class="line">   		<span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">                 	<span class="keyword">FROM</span> Reserves R1, Reserves R2) 		</span><br><span class="line">                  <span class="keyword">WHERE</span> ...</span><br><span class="line">                  		<span class="keyword">AND</span> R1.day <span class="operator">!=</span> R2.day </span><br><span class="line">   						</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>查找只被一个水手预定过的船的bid</span><br><span class="line"><span class="keyword">SELECT</span> bid </span><br><span class="line"><span class="keyword">FROM</span> Reserves R1</span><br><span class="line"><span class="keyword">WHERE</span> bid <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> bid          <span class="operator">/</span><span class="operator">/</span>被其他水手订过的船的bid</span><br><span class="line">									<span class="keyword">FROM</span> Reserves R2 </span><br><span class="line">                  <span class="keyword">WHERE</span> R2.sid ¬<span class="operator">=</span> R1.sid)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>op ANY</code>  <code>op ALL</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>找到一个水手比至少一个叫Horatio的水手评分高的（只要比一个高就行）</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> SailorsS</span><br><span class="line"><span class="keyword">WHERE</span> S.rating<span class="operator">&gt;</span><span class="keyword">ANY</span> (<span class="keyword">SELECT</span> S2.rating</span><br><span class="line">										<span class="keyword">FROM</span> SailorsS2</span><br><span class="line">										<span class="keyword">WHERE</span> S2.sname<span class="operator">=</span>‘Horatio’)</span><br></pre></td></tr></table></figure>
<h3 id="除法与聚集函数计算-P66"><a href="#除法与聚集函数计算-P66" class="headerlink" title="除法与聚集函数计算 P66"></a>除法与聚集函数计算 P66</h3></li>
<li><p>Division</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>查找那些预定过所有船的水手</span><br><span class="line"><span class="keyword">SELECT</span> S.sname <span class="keyword">FROM</span> Sailors S </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>         <span class="operator">/</span><span class="operator">/</span>不存在没有预定的船</span><br><span class="line">        ((<span class="keyword">SELECT</span> B.bid <span class="keyword">FROM</span> Boats B)</span><br><span class="line">          <span class="keyword">EXCEPT</span>          <span class="operator">/</span><span class="operator">/</span>排除那些已经有人预定过的船的bid</span><br><span class="line">         (<span class="keyword">SELECT</span> R.bid</span><br><span class="line">          <span class="keyword">FROM</span> Reserves R </span><br><span class="line">          <span class="keyword">WHERE</span> R.sid<span class="operator">=</span>S.sid))</span><br></pre></td></tr></table></figure></li>
<li><p>Aggregate Operators</p>
<ul>
<li>COUNTS(*)：统计找到的元组总数</li>
<li>COUNT([DISTINCT] A)：返回不重复的属性A的值有多少个</li>
<li>SUM([DISTINCT] A)：返回不重复的属性A的值总和</li>
<li>AVG([DISTINCT] A)：返回不重复的属性A的值平均值</li>
<li>MAX(A)：属性A所有值中的最大值</li>
<li>MIN(A)：属性A所有值中的最小值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span> (<span class="operator">*</span>)   <span class="operator">/</span><span class="operator">/</span>所有的元组</span><br><span class="line"><span class="keyword">FROM</span> SailorsS</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span> (S.age)   <span class="operator">/</span><span class="operator">/</span>评分为<span class="number">10</span>的水手平均年龄</span><br><span class="line"><span class="keyword">FROM</span> SailorsS</span><br><span class="line"><span class="keyword">WHERE</span> S.rating<span class="operator">=</span><span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span> (<span class="keyword">DISTINCT</span> S.rating)   <span class="operator">/</span><span class="operator">/</span>叫Bob的有多少种评分</span><br><span class="line"><span class="keyword">FROM</span> SailorsS</span><br><span class="line"><span class="keyword">WHERE</span> S.sname<span class="operator">=</span>‘Bob’</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span> (<span class="keyword">DISTINCT</span> S.age)   <span class="operator">/</span><span class="operator">/</span>评分为<span class="number">10</span>的有几种年龄</span><br><span class="line"><span class="keyword">FROM</span> SailorsS </span><br><span class="line"><span class="keyword">WHERE</span> S.rating<span class="operator">=</span><span class="number">10</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> S.sname        <span class="operator">/</span><span class="operator">/</span>评分最高的水手名字</span><br><span class="line"><span class="keyword">FROM</span> SailorsS</span><br><span class="line"><span class="keyword">WHERE</span> S.rating<span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(S2.rating)</span><br><span class="line">									<span class="keyword">FROM</span> SailorsS2)</span><br></pre></td></tr></table></figure>
<h3 id="分组聚集函数计算-P68-69"><a href="#分组聚集函数计算-P68-69" class="headerlink" title="分组聚集函数计算 P68-69"></a>分组聚集函数计算 P68-69</h3></li>
<li><p>为什么分组</p>
<ul>
<li>例子：要找到每种评分中最年轻的水手（不知道有几种评分）</li>
</ul>
</li>
<li><p><code>GROUP BY</code>  <code>HAVING </code>  <em>通常会和聚集函数一起用</em></p>
<ul>
<li>按列的值分组，一样的分在一组</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">DISTINCT</span>] target<span class="operator">-</span>list </span><br><span class="line"><span class="keyword">FROM</span> relation<span class="operator">-</span>list</span><br><span class="line"><span class="keyword">WHERE</span> qualification</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">grouping</span><span class="operator">-</span>list</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">group</span><span class="operator">-</span>qualification  <span class="operator">/</span><span class="operator">/</span>属性必须是<span class="keyword">grouping</span><span class="operator">-</span>list的子集，不然语法报错</span><br></pre></td></tr></table></figure>
<ul>
<li><p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>找到年龄大于<span class="number">18</span>的最年轻水手的年纪，并且这个水手的评分必须至少还有一人和他一样</span><br><span class="line"><span class="keyword">SELECT</span> S.rating, <span class="built_in">MIN</span> (S.age) <span class="keyword">AS</span> minage  <span class="operator">/</span><span class="operator">/</span><span class="keyword">SELECT</span>最后执行</span><br><span class="line"><span class="keyword">FROM</span> SailorsS </span><br><span class="line"><span class="keyword">WHERE</span> S.age <span class="operator">&gt;=</span> <span class="number">18</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> S.rating </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span> (<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>  <span class="operator">/</span><span class="operator">/</span><span class="keyword">HAVING</span> <span class="built_in">COUNT</span> (<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span> <span class="keyword">AND</span> <span class="keyword">EVERY</span> (S.age <span class="operator">&lt;=</span><span class="number">60</span>)表示组内水手必须满足所有人年龄小于<span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>找到每艘红船的预定数量</span><br><span class="line"><span class="keyword">SELECT</span> B.bid, <span class="built_in">COUNT</span> (<span class="operator">*</span>) <span class="keyword">AS</span> scount  <span class="operator">/</span><span class="operator">/</span><span class="number">3.</span> 再统计每组的数量</span><br><span class="line"><span class="keyword">FROM</span> Boats B,Reserves R</span><br><span class="line"><span class="keyword">WHERE</span> R.bid<span class="operator">=</span>B.bid <span class="keyword">AND</span> B.color<span class="operator">=</span>‘red’  <span class="operator">/</span><span class="operator">/</span><span class="number">1.</span> 先找到红船</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> B.bid  <span class="operator">/</span><span class="operator">/</span><span class="number">2.</span>然后分组</span><br></pre></td></tr></table></figure></li>
<li><p>聚集函数不能嵌套使用</p>
<ul>
<li><p>例子</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>找到平均年龄最小的评分</span><br><span class="line"><span class="keyword">SELECT</span> S.rating</span><br><span class="line"><span class="keyword">FROM</span> Sailors S</span><br><span class="line"><span class="keyword">WHERE</span> S.age <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span> (<span class="built_in">AVG</span> (S2.age))   <span class="operator">/</span><span class="operator">/</span>错误！！！</span><br><span class="line"><span class="keyword">FROM</span> Sailors S2)</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>改正</span><br><span class="line"><span class="keyword">SELECT</span> Temp.rating</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> S.rating, <span class="built_in">AVG</span> (S.age) <span class="keyword">AS</span> avgage  <span class="operator">/</span><span class="operator">/</span><span class="number">2.</span>再取每个组内的平均值</span><br><span class="line">			<span class="keyword">FROM</span> SailorsS</span><br><span class="line">			<span class="keyword">GROUP</span> <span class="keyword">BY</span> S.rating) <span class="keyword">AS</span> Temp    <span class="operator">/</span><span class="operator">/</span><span class="number">1.</span>先按评分分组</span><br><span class="line"><span class="keyword">WHERE</span> Temp.avgage <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span> (Temp.avgage)  <span class="operator">/</span><span class="operator">/</span><span class="number">3.</span>取平均值值最小的</span><br><span class="line">										<span class="keyword">FROM</span> Temp)</span><br></pre></td></tr></table></figure>
<p><del>fuck 今天是一点不想复习啊</del> </p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="CAST与CASE表达式"><a href="#CAST与CASE表达式" class="headerlink" title="CAST与CASE表达式"></a>CAST与CASE表达式</h3><ul>
<li><p>CAST</p>
<blockquote>
<p>强制数据类型转换</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, school, <span class="built_in">CAST</span>(<span class="keyword">NULL</span> <span class="keyword">AS</span> <span class="type">Varchar</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">FROM</span> Students</span><br></pre></td></tr></table></figure></li>
<li><p>CASE</p>
<blockquote>
<p>跟在SELECT后面</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>Officers (name, status, rank, title)</span><br><span class="line"><span class="keyword">SELECT</span> name, <span class="keyword">CASE</span> status</span><br><span class="line">              <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> ‘Active Duty’ </span><br><span class="line">              <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> ‘Reserve’</span><br><span class="line">              <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> ‘Special Assignment’ </span><br><span class="line">              <span class="keyword">WHEN</span> <span class="number">4</span> <span class="keyword">THEN</span> ‘Retired’</span><br><span class="line">              <span class="keyword">ELSE</span> ‘<span class="literal">Unknown</span>’</span><br><span class="line">              <span class="keyword">END</span> </span><br><span class="line">            <span class="keyword">AS</span> status </span><br><span class="line"><span class="keyword">FROM</span> Officers </span><br></pre></td></tr></table></figure>
<h3 id="标量子查询"><a href="#标量子查询" class="headerlink" title="标量子查询"></a>标量子查询</h3></li>
</ul>
<blockquote>
<p>dept(deptno,  deptname, location)</p>
<p>emp(deptno, salary, bonus)</p>
</blockquote>
<ul>
<li>就是这个子查询只会返回一个元组</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>找到那些平均奖金高于平均工资的部门</span><br><span class="line"><span class="keyword">SELECT</span> d.deptname, d.location </span><br><span class="line"><span class="keyword">FROM</span> dept <span class="keyword">AS</span> d</span><br><span class="line"><span class="keyword">WHERE</span> (<span class="keyword">SELECT</span> <span class="built_in">avg</span>(bonus)</span><br><span class="line">			FORM emp</span><br><span class="line">			<span class="keyword">WHERE</span> deptno<span class="operator">=</span>d.deptno) </span><br><span class="line">			<span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">avg</span>(salary)</span><br><span class="line">				FORM emp</span><br><span class="line">				<span class="keyword">WHERE</span> deptno<span class="operator">=</span>d.deptno)</span><br></pre></td></tr></table></figure>
<h3 id="表表达式与公共表表达式"><a href="#表表达式与公共表表达式" class="headerlink" title="表表达式与公共表表达式"></a>表表达式与公共表表达式</h3><ul>
<li>Table Expression<ul>
<li>就是说会返回一个表</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">找到那些总支出大于<span class="number">200000</span>的部门们</span><br><span class="line"><span class="keyword">SELECT</span> deptno, totalpay</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> deptno, <span class="built_in">sum</span>(salay)<span class="operator">+</span><span class="built_in">sum</span>(bonus) <span class="keyword">AS</span> totalpay</span><br><span class="line"><span class="keyword">FROM</span> emp</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno) <span class="keyword">AS</span> payroll <span class="keyword">WHERE</span> totalpay<span class="operator">&gt;</span><span class="number">200000</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>Common Table Expression<ul>
<li>用<code>WITH</code>创建一个临时表相当于</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>找到总支出最大的部门</span><br><span class="line"><span class="keyword">WITH</span> payroll (deptno, totalpay) <span class="keyword">AS</span></span><br><span class="line">		(<span class="keyword">SELECT</span> deptno, <span class="built_in">sum</span>(salary)<span class="operator">+</span><span class="built_in">sum</span>(bonus) </span><br><span class="line">     <span class="keyword">FROM</span> emp</span><br><span class="line">  	 <span class="keyword">GROUP</span> <span class="keyword">BY</span> deptno) </span><br><span class="line"><span class="keyword">SELECT</span> deptno</span><br><span class="line"><span class="keyword">FROM</span> payroll</span><br><span class="line"><span class="keyword">WHERE</span> totalpay <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">max</span>(totalpay)</span><br><span class="line">									<span class="keyword">FROM</span> payroll);</span><br><span class="line">									</span><br></pre></td></tr></table></figure>
<h3 id="递归子查询"><a href="#递归子查询" class="headerlink" title="递归子查询"></a>递归子查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>找到所有上司是Hoover的员工，并且他们的薪水都高于<span class="number">100000</span></span><br><span class="line"><span class="keyword">WITH</span> agents (name, salary) <span class="keyword">AS</span></span><br><span class="line">  ((<span class="keyword">SELECT</span> name, salary     <span class="comment">--initial query</span></span><br><span class="line">		<span class="keyword">FROM</span> FedEmp</span><br><span class="line">		<span class="keyword">WHERE</span> manager<span class="operator">=</span>‘Hoover’)</span><br><span class="line">	<span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">	 (<span class="keyword">SELECT</span> f.name, f.salary   <span class="comment">--recursive query</span></span><br><span class="line">		<span class="keyword">FROM</span> agents <span class="keyword">AS</span> a, FedEmp <span class="keyword">AS</span> f</span><br><span class="line">		<span class="keyword">WHERE</span> f.manager <span class="operator">=</span> a.name)) </span><br><span class="line"><span class="keyword">SELECT</span> name                 <span class="comment">--final query</span></span><br><span class="line"><span class="keyword">FROM</span> agents</span><br><span class="line"><span class="keyword">WHERE</span> salary<span class="operator">&gt;</span><span class="number">100000</span> ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>一个比较复杂的例子</span><br><span class="line"><span class="keyword">WITH</span> trips (destination, route, nsegs, totalcost) <span class="keyword">AS</span></span><br><span class="line">		((<span class="keyword">SELECT</span> destination, <span class="built_in">CAST</span>(destination <span class="keyword">AS</span> <span class="type">varchar</span>(<span class="number">20</span>)), <span class="number">1</span>, cost</span><br><span class="line">			<span class="keyword">FROM</span> flights              <span class="comment">--- initial query</span></span><br><span class="line">			<span class="keyword">WHERE</span> origin<span class="operator">=</span>‘SFO’) </span><br><span class="line">     <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line">			(<span class="keyword">SELECT</span> f.destination, <span class="comment">--- recursive query </span></span><br><span class="line">       <span class="built_in">CAST</span>(t.route<span class="operator">||</span>’,’<span class="operator">||</span>f.destination <span class="keyword">AS</span> <span class="type">varchar</span>(<span class="number">20</span>)),</span><br><span class="line">				t.nsegs<span class="operator">+</span><span class="number">1</span>, t.totalcost<span class="operator">+</span>f.cost</span><br><span class="line"> 			 <span class="keyword">FROM</span> trips t, flights f </span><br><span class="line">       <span class="keyword">WHERE</span> t.destination<span class="operator">=</span>f.origin</span><br><span class="line">							<span class="keyword">AND</span> f.destination<span class="operator">&lt;&gt;</span>’SFO’  <span class="comment">--- stopping rule 1</span></span><br><span class="line">       				<span class="keyword">AND</span> f.origin<span class="operator">&lt;&gt;</span>’JFK’      <span class="comment">--- stopping rule 2</span></span><br><span class="line">       				<span class="keyword">AND</span> t.nsegs<span class="operator">&lt;=</span><span class="number">3</span>))       <span class="comment">--- stopping rule 3</span></span><br><span class="line"><span class="keyword">SELECT</span> route, totalcost       <span class="comment">--- final query</span></span><br><span class="line"><span class="keyword">FROM</span> trips</span><br><span class="line"><span class="keyword">WHERE</span> destination<span class="operator">=</span>‘JFK’ <span class="keyword">AND</span> totalcost<span class="operator">=</span>   <span class="comment">--- lowest cost rule</span></span><br><span class="line"> 													（<span class="keyword">SELECT</span> <span class="built_in">min</span>(totalcost)</span><br><span class="line"> 														<span class="keyword">FROM</span> trips</span><br><span class="line"> 														<span class="keyword">WHERE</span> destination<span class="operator">=</span><span class="string">&#x27;JFK&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="数据操纵语言-P69-71"><a href="#数据操纵语言-P69-71" class="headerlink" title="数据操纵语言 P69-71"></a>数据操纵语言 P69-71</h2><ul>
<li><code>INSERT</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMPLOYEES <span class="keyword">VALUES</span> (<span class="string">&#x27;Smith&#x27;</span>, <span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;1980-06-10&#x27;</span>, <span class="string">&#x27;Los Angles&#x27;</span>, <span class="number">16</span>, <span class="number">45000</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>DELETE</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Person <span class="keyword">WHERE</span> LastName <span class="operator">=</span> <span class="string">&#x27;Rasmussen&#x27;</span> ;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>UPDATE</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Person <span class="keyword">SET</span> Address <span class="operator">=</span> <span class="string">&#x27;Zhongshan 23&#x27;</span>, City <span class="operator">=</span> <span class="string">&#x27;Nanjing&#x27;</span> <span class="keyword">WHERE</span> LastName <span class="operator">=</span> <span class="string">&#x27;Wilson&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="关于视图-P72-75"><a href="#关于视图-P72-75" class="headerlink" title="关于视图 P72-75"></a>关于视图 P72-75</h2><ul>
<li><p>普通视图</p>
</li>
<li><p>临时视图和递归查询</p>
<h2 id="嵌入式SQL-P75-79"><a href="#嵌入式SQL-P75-79" class="headerlink" title="嵌入式SQL P75-79"></a>嵌入式SQL P75-79</h2></li>
<li><p>为了直接在其他编程语言中直接访问数据库</p>
</li>
<li><p>以<code>EXEC SQL</code>开头，<code>;</code>结尾</p>
</li>
<li><p>通过宿主变量（host variables）与程序交流，在SQL语句中宿主变量前面必须加<code>:</code>；只能是一般变量，不能是数组或者其他结构</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>定义宿主变量</span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">BEGIN</span> <span class="keyword">DECLARE</span> SECTION; <span class="type">char</span> SNO[<span class="number">7</span>];</span><br><span class="line"><span class="type">char</span> GIVENSNO[<span class="number">7</span>];</span><br><span class="line"><span class="type">char</span> CNO[<span class="number">6</span>];</span><br><span class="line"><span class="type">char</span> GIVENCNO[<span class="number">6</span>];</span><br><span class="line"><span class="type">float</span> GRADE;</span><br><span class="line">short GRADEI; <span class="comment">/*indicator of GRADE，为负数则表示GRADE为NULL*/</span></span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">END</span> <span class="keyword">DECLARE</span> SECTION;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><p>特殊的宿主变量<code>SQLCA</code>,通常用<code>SQLCA&gt;SQLCODE</code>来表示SQL执行结果</p>
<blockquote>
<p>&lt;0表示出错且未执行</p>
<p>=0表示正常</p>
<p>&gt;0表示已执行，但有异常</p>
<p>=100表示无数据可取，通常是数据取完了</p>
</blockquote>
</li>
<li><p><code>CONNECT</code></p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">CONNECT</span> :uid IDENTIFIED <span class="keyword">BY</span> :pwd;</span><br></pre></td></tr></table></figure>
<ul>
<li>执行查询或者操作</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> SC(SNO,CNO,GRADE)</span><br><span class="line"><span class="keyword">VALUES</span>(:SNO, :CNO, :GRADE);</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">SELECT</span> GRADE</span><br><span class="line">				 <span class="keyword">INTO</span> :GRADE :GRADEI    <span class="operator">/</span><span class="operator">/</span>因为只能查到一个值，所以可以直接赋值</span><br><span class="line">				 <span class="keyword">FROM</span> SC</span><br><span class="line">				 <span class="keyword">WHERE</span> SNO<span class="operator">=</span>:GIVENSNO <span class="keyword">AND</span></span><br><span class="line">							 CNO<span class="operator">=</span>:GIVENCNO;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>CURSOR</code> 可以将多个查到的值放入数组</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> INCLUDE SQLCA    </span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">BEGIN</span> <span class="keyword">DECLARE</span> SECTION;</span><br><span class="line"><span class="type">char</span> sname[<span class="number">20</span>];</span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">END</span> <span class="keyword">DECLARE</span> SECTION;</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">DECLARE</span> student<span class="operator">-</span><span class="keyword">cursor</span> <span class="keyword">CURSOR</span> <span class="keyword">FOR</span>   <span class="comment">--Step1：声明游标</span></span><br><span class="line">  <span class="keyword">SELECT</span> S.sname</span><br><span class="line">  <span class="keyword">FROM</span> student S</span><br><span class="line">  <span class="keyword">WHERE</span> S.gpa<span class="operator">&gt;</span><span class="number">3.5</span></span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">OPEN</span> student<span class="operator">-</span><span class="keyword">cursor</span>;              <span class="comment">--Step2：打开游标</span></span><br><span class="line">while(<span class="literal">TRUE</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">FETCH</span> C1 <span class="keyword">INTO</span> :sname;       <span class="comment">--Step3: 读数据</span></span><br><span class="line">  if(SQLCA.SQLCODE<span class="operator">=</span><span class="operator">=</span><span class="number">100</span>) <span class="comment">--读完了</span></span><br><span class="line">    break;</span><br><span class="line">  if(SQLCA.SQLCODE<span class="operator">&lt;</span><span class="number">0</span>)    <span class="comment">--出错了</span></span><br><span class="line">    break;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  ...处理游标中所取的数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  printf(&quot;%s\n&quot;, sname);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">EXEC</span> <span class="keyword">SQL</span> <span class="keyword">CLOSE</span> C1;             <span class="comment">--Step4：关闭游标</span></span><br></pre></td></tr></table></figure>
<h2 id="动态SQL与存储过程-P79-82"><a href="#动态SQL与存储过程-P79-82" class="headerlink" title="动态SQL与存储过程 P79-82"></a>动态SQL与存储过程 P79-82</h2><p><del>考到了就现学</del></p>
<h1 id="Chapter-4-数据库管理系统"><a href="#Chapter-4-数据库管理系统" class="headerlink" title="Chapter 4 数据库管理系统"></a>Chapter 4 数据库管理系统</h1><h2 id="DBMS核心的模块结构-P88-90"><a href="#DBMS核心的模块结构-P88-90" class="headerlink" title="DBMS核心的模块结构 P88-90"></a>DBMS核心的模块结构 P88-90</h2><p><img src="https://acupofair.github.io/posts/dbms/res/2021-12-05-12-41-46.png" alt="img"></p>
<ul>
<li>用户写的应用程序经过接口转为基础的数据库语言（SQL等）</li>
<li>SQL经过词法及语法分析产生语法树</li>
<li>之后检查用户是否有权访问语法树涉及的数据对象，若通过则继续执行，否则拒绝执行</li>
<li>授权检查通过后，进行语义分析与处理，对四种语言分别做不同处理（通常统称为查询处理），其中QL最复杂也最基本，存在多种存取路径选择问题（查询优化） 后就形成SQL语句执行</li>
<li>DLL： 存放SQL的动态链接库</li>
<li>并发控制： SQL语句执行过程都有并发控制以防止多用户并发访问数据引起数据不一致</li>
<li>恢复机制：发生故障时，能使数据库恢复到最近的一致状态或先前的某个一致状态</li>
<li>DBMS是操作系统之上的软件系统，是操作系统的用户,它对系统资源的调用需要请求操作系统为其服务，通过系统调用来实现</li>
</ul>
<blockquote>
<p>事务：DBMS的执行单位  P89-90</p>
<p>ACID准则</p>
</blockquote>
<h2 id="DBMS进程结构"><a href="#DBMS进程结构" class="headerlink" title="DBMS进程结构"></a>DBMS进程结构</h2><ul>
<li><p>单进程结构</p>
<ul>
<li>程进的一单个一是就后行运，起一在接连码代心核 和码代的序程用应把</li>
</ul>
</li>
<li><p>多进程结构</p>
<ul>
<li>一个应用对应一个DBMS进程</li>
</ul>
<img src="/Users/thisisbadbao/Library/Application Support/typora-user-images/image-20211227164149553.png" alt="image-20211227164149553" style="zoom:50%;" />

<ul>
<li>一个应用对用一个 DBMS的一个线程</li>
</ul>
<img src="/Users/thisisbadbao/Library/Application Support/typora-user-images/image-20211227164230234.png" alt="image-20211227164230234" style="zoom:30%;" />

</li>
</ul>
<h2 id="数据库访问管理-P101-111"><a href="#数据库访问管理-P101-111" class="headerlink" title="数据库访问管理 P101-111"></a>数据库访问管理 P101-111</h2><ul>
<li>访问类型<ul>
<li>查询一个文件的全部或大部分记录(&gt;15%)</li>
<li>查询某一条特定记录</li>
<li>查询某些记录(&lt;15%)</li>
<li>范围查询</li>
<li>记录的更新</li>
</ul>
</li>
<li>文件管理<ul>
<li>堆文件<ul>
<li>记录按插入顺序存放，就像堆货物一样。物理地址不一定连续，逻辑地址连续。插入容易，查找难，只能顺序搜索，删除麻烦，一般不在物理上删除，只是打删除标志，以免引起大量记录转移。</li>
</ul>
</li>
<li>直接文件<ul>
<li>将记录某一属性（一般为主键）用散列函数映射成记录的地址。按散列键访问快，但不同散列键可能映射同一地址，且只对散列键到记录的访问有效，键映射空间固定，不变处理变长记录，用得少</li>
</ul>
</li>
<li>索引文件<ul>
<li>索引+堆文件/簇集</li>
<li>在记录的某一属性（组）上建立索引，索引项由索引键的值及其对应的记录的地址货地址集组成。</li>
<li>提高查询效率，增加索引维护开销，付出储存空间代价</li>
</ul>
</li>
</ul>
</li>
<li>索引<ul>
<li>B+树（最常用）</li>
<li>Clustering index（常用）</li>
<li>倒排文件</li>
<li>动态hash</li>
<li>栅格结构文件</li>
</ul>
</li>
</ul>
<h2 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h2><ul>
<li><p>代数优化（粗糙的优化）</p>
<ul>
<li>对查询进行等效变化，以减少执行的开销</li>
<li>先一元操作，后二元操作，可以提取一些公共操作</li>
</ul>
</li>
<li><p>操作优化（优化的重点）</p>
<ul>
<li><p>合理选择存取路径</p>
</li>
<li><p>选择、投影、集合、连接、组合操作的优化</p>
</li>
<li><p>主要是连接操作的优化，因为开销最大</p>
<ul>
<li><p>嵌套循环法</p>
<ul>
<li>R为外关系，共bRb_R<em>b**R</em>条记录，S为内关系，共bSb_S<em>b**S</em>条记录,R每次I/O取出的为缓冲块大小的元组个数，设有nBn_B<em>n**B</em>个缓冲块,一块用于内关系缓冲，其余用于外关系缓冲,则共需访问物理块数,从公式可以看出要想减少I/O次数，应该让小关系作为内关系，因为它前面有个乘数。</li>
<li><img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211227185636.png" alt="image-20211227185631856" style="zoom:50%;" /></li>
<li>为什么缓存块都给外缓冲？</li>
<li>因为，<strong>内关系的扫描次数取决于外关系分多少次取完，外关系每次取的越多，则内关系一次扫描所比较的元组也越多</strong>。而内关系每次扫描都要I/O整个表，而总的I/O次数中外关系的I/O次数是定值（它只用扫描一次），内关系的I/O次数只取决于其扫描次数↣\rightarrowtail↣其扫描次数只取决于外关系取的次数↣\rightarrowtail↣外关系取的次数取决于每次取多少，所以增大外缓冲能有效减小内关系扫描次数。</li>
</ul>
</li>
<li><p>利用索引或散列寻找匹配元组法</p>
</li>
<li><p>排序归并法</p>
</li>
<li><p>散列连接法</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="恢复机制"><a href="#恢复机制" class="headerlink" title="恢复机制"></a>恢复机制</h2><blockquote>
<p>减少可能出现的错误</p>
<p>从错误中恢复</p>
</blockquote>
<ul>
<li><p>周期性转储</p>
<ul>
<li><p>每隔一段时间将磁盘数据转储到磁带（不受系统故障影响）上</p>
<p>转储采用增量转储</p>
</li>
<li><p>只能恢复到最近一次备份</p>
</li>
</ul>
</li>
<li><p>备份+日志</p>
<ul>
<li>日志（Log）：记录上次备份以来所有数据库的改变<ul>
<li>前像（Before Image）<ul>
<li>事务更新时所涉及物理块更新前的映像；有前像可使数据库回到更新前状态，即撤销更新undo,满足幂等性,就是无论undo几次都和undo一次的效果一样</li>
</ul>
</li>
<li>后像（A.I）<ul>
<li>事务更新时所涉及物理块更新后的映像；有后像即时更新数据丢失，仍可恢复到更新后状态，叫重做redo,也满足幂等性</li>
</ul>
</li>
<li>事务状态：两种,commit了，说明事务已成功执行(all)；事务失败，则要消除事务对数据库影响(nothing)，叫卷回(abort/rollback) 数据库失效时，可取出最近副本，再根据运行记录<ul>
<li>对已提交的事务<strong>用后像重做</strong>，叫<strong>向前恢复</strong></li>
<li>对未提交的事务<strong>用前像卷回</strong>，叫<strong>向后恢复</strong> 这样可使数据库恢复至最近的<strong>一致状态</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>数据结构</p>
<ul>
<li>Commit list ：所有已经提交的事物列表</li>
<li>Active list：当前在运行的、还没有提交的事物的标识符（TID）</li>
<li>Log</li>
</ul>
</li>
<li><p>提交规则</p>
<ul>
<li>A.I必须在commit之前就写入硬盘</li>
</ul>
</li>
<li><p>日志提前规则</p>
<ul>
<li>若A.I在事务提交之前写入数据库，必须先把B.I先写入Log</li>
</ul>
</li>
<li><p>幂等性</p>
<ul>
<li>redo和undo做几次都效果一样</li>
</ul>
</li>
<li><p>三种更新策略</p>
<ul>
<li><p>A.I在事务提交之前写入DB：</p>
<ul>
<li>TID写入active list</li>
<li>B.I写入日志[Log Ahead Rule]</li>
<li>A.I写入DB [Commit Rule]</li>
<li>TID写入commit list</li>
<li>在active list中删去TID</li>
</ul>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211227192056.png" alt="image-20211227191451676" style="zoom:50%;" />
</li>
<li><p>A.I在事务提交之后写入DB：  （流行的用法）</p>
<ul>
<li><p>TID进入active list</p>
</li>
<li><p>A.I写入log[Commit Rule]</p>
</li>
<li><p>TID写入commit list</p>
</li>
<li><p>A.I写入DB</p>
</li>
<li><p>在active list中删去TID</p>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211227192103.png" alt="image-20211227191813497" style="zoom:50%;" />
</li>
</ul>
</li>
<li><p>A.I写入DB与commit并发进行：</p>
<ul>
<li><p>TID进入active list</p>
</li>
<li><p>A.I和B.I写入log[Two Rules]</p>
</li>
<li><p>A.I写入DB(partially done)</p>
</li>
<li><p>TID写入commit list</p>
</li>
<li><p>A.I写入DB(completed)</p>
</li>
<li><p>在active list中删去TID</p>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211227192107.png" alt="image-20211227192047509" style="zoom:50%;" />


</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="并发控制-P148-153"><a href="#并发控制-P148-153" class="headerlink" title="并发控制 P148-153"></a>并发控制 P148-153</h2><ul>
<li><p>并发的问题</p>
<ul>
<li>丢失更新（write-write conflict）</li>
<li>读脏数据（read-write conflict）</li>
<li>读值不可复现</li>
</ul>
<img src="https://gitee.com/thisisbadBao/imgrepo/raw/master/imgrepo1/20211227192922.png" alt="image-20211227192917832" style="zoom:50%;" />

</li>
</ul>
<h2 id="加锁协议"><a href="#加锁协议" class="headerlink" title="加锁协议"></a>加锁协议</h2><ul>
<li><p>2PL(two phase locking):    释放锁在所有加锁之后</p>
</li>
<li><p>well-formed:遵循先加锁，后操作</p>
</li>
<li><p>X锁（排他性）</p>
<table>
<thead>
<tr>
<th>\</th>
<th>NL</th>
<th>X</th>
</tr>
</thead>
<tbody><tr>
<td>NL</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>X</td>
<td>Y</td>
<td>N</td>
</tr>
</tbody></table>
</li>
<li><p>(S,X)锁，S用于读，X用于写</p>
<table>
<thead>
<tr>
<th>\</th>
<th>NL</th>
<th>s</th>
<th>x</th>
</tr>
</thead>
<tbody><tr>
<td>NL</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>S</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
</tr>
<tr>
<td>X</td>
<td>Y</td>
<td>N</td>
<td>N</td>
</tr>
</tbody></table>
</li>
<li><p>(S,U,X锁)，S用于读，U锁一般先申请，然后去更新数据，在最后写入阶段再去申请X锁，X用于写</p>
<table>
<thead>
<tr>
<th>\</th>
<th>NL</th>
<th>S</th>
<th>u</th>
<th>x</th>
</tr>
</thead>
<tbody><tr>
<td>NL</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>S</td>
<td>Y</td>
<td>N</td>
<td>Y</td>
<td>N</td>
</tr>
<tr>
<td>U</td>
<td>Y</td>
<td>Y</td>
<td>N</td>
<td>N</td>
</tr>
<tr>
<td>X</td>
<td>Y</td>
<td>N</td>
<td>N</td>
<td>N</td>
</tr>
</tbody></table>
</li>
</ul>
<h2 id="死锁与活锁-P156-159"><a href="#死锁与活锁-P156-159" class="headerlink" title="死锁与活锁 P156-159"></a>死锁与活锁 P156-159</h2><ul>
<li><p>死锁：循环等待，没有事务可以得到需要的资源来完成事务</p>
<ul>
<li><p>处理：预防&amp;解决</p>
</li>
<li><p>检测死锁：</p>
<ul>
<li>超时法：超过某一时限，则认为发生死锁</li>
<li>等待图法：出现回路则有死锁</li>
</ul>
</li>
<li><p>防止死锁</p>
<ul>
<li>与操作系统类似的方法</li>
<li>将数据对象按序编号，按序申请</li>
<li>当事务申请锁未获准时不是一律等待，而是让一些事务卷回重执(retry),以避免循环等待。为区别事务开始执行的先后，给他们一个随时间增长的时间标记ts(time stamp)<ul>
<li>事务重执有两种策略<ul>
<li>死亡-等待wait-die:年老的等年轻的事务,年轻的来了，则重执，一直到自己变得年老而等待</li>
<li>击伤-等待wound-die:年轻的等年老的，年老的来了，把年轻的击败，年轻的重执时直接等待</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>活锁：别的事务一直占用资源，低优先级的一直拿不到资源</p>
<ul>
<li>处理：FIFO</li>
</ul>
</li>
</ul>
<h1 id="Chapter-5-数据库的安全与完整性约束"><a href="#Chapter-5-数据库的安全与完整性约束" class="headerlink" title="Chapter 5 数据库的安全与完整性约束"></a>Chapter 5 数据库的安全与完整性约束</h1><h2 id="数据库的安全"><a href="#数据库的安全" class="headerlink" title="数据库的安全"></a>数据库的安全</h2><ol>
<li>利用视图和查询修改</li>
<li>访问控制（对用户进行分类来给不同的权限 ）</li>
</ol>
<ul>
<li>普通用户</li>
<li>DBA</li>
<li>有资源特权的用户</li>
</ul>
<ol>
<li>用户标识和用户认证</li>
</ol>
<ul>
<li>通过password进行用户认证</li>
<li>特殊的物品，如钥匙. IC卡等等</li>
</ul>
<ol>
<li>授权</li>
<li>Role角色机制（通过该方法提高权限控制）</li>
<li>数据加密</li>
</ol>
<ul>
<li>加密后存储【密码学】，但是加密解密影响效率</li>
</ul>
<ol>
<li>审计追踪</li>
</ol>
<ul>
<li>结合数据库日志，可以在关注的对象上添加审计追踪，会记录该对象上进行的操作</li>
</ul>
<h2 id="完整性约束"><a href="#完整性约束" class="headerlink" title="完整性约束"></a>完整性约束</h2><blockquote>
<p>完整性约束就是规则，一张表内所有元组都要满足的条件就是完整性约束</p>
</blockquote>
<ul>
<li><p>完整性约束的分类 </p>
<ul>
<li><p>静态约束</p>
<ul>
<li>固有约束：数据模型固有的约束，如关系属性应该是原子的,即第一范式</li>
<li>隐含约束：数据库表的模式定义里面的约束,一般用DDL语句说明，如：域约束、实体完整性约束、外键约束【引用完整性约束】</li>
<li>显式约束：书p181,没解释清</li>
</ul>
</li>
<li><p>动态约束</p>
<ul>
<li>数据库在状态转换中要满足的约束叫做动态约束(可以和触发器联系)</li>
</ul>
</li>
</ul>
</li>
<li><p>完整性约束的说明 </p>
<ul>
<li><p>用过程说明：把约束的说明和检验交给应用程序</p>
</li>
<li><p>用断言说明：断言指数据库状态必须满足的逻辑条件</p>
</li>
<li><p>在基表定义中加入<code>CHECK</code>子句约束</p>
</li>
<li><p>用触发子表示约束,下小节细讲</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Sailors(</span><br><span class="line">  sid <span class="type">INTEGER</span>,</span><br><span class="line">  sname <span class="type">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">  rating <span class="type">INTEGER</span>,</span><br><span class="line">  age <span class="type">REAL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>(sid),</span><br><span class="line">  <span class="keyword">CHECK</span>(rating<span class="operator">&gt;=</span><span class="number">1</span> <span class="keyword">AND</span> rating<span class="operator">&lt;=</span><span class="number">10</span>));</span><br><span class="line">  </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Sailors (</span><br><span class="line">	sid <span class="type">INTEGER</span>,</span><br><span class="line">	sname <span class="type">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">	age <span class="type">REAL</span>,</span><br><span class="line">	<span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>(sid),</span><br><span class="line">	<span class="keyword">CHECK</span>(</span><br><span class="line">	(<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(S.sid) <span class="keyword">FROM</span> Sailors S)</span><br><span class="line">	<span class="operator">+</span>(<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(B.bid) <span class="keyword">FROM</span> Boats B)<span class="operator">&lt;</span><span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><ul>
<li>主动数据库：能对数据库采取一些主动的动作。<ul>
<li>数据库的主动依赖于规则<ul>
<li>规则：ECA规则，E为事件、C为条件、A为动作。</li>
<li>即当事件A发生，且条件C满足时，采取A动作</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>在往水手表中插入水手时，若年龄小于<span class="number">18</span>则插入年轻水手表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> youngSailorUpdate          <span class="comment">--声明触发器</span></span><br><span class="line">AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> SALORS                    <span class="comment">--Event</span></span><br><span class="line"><span class="keyword">REFERENCING</span> <span class="keyword">NEW</span> <span class="keyword">TABLE</span> NewSailors          <span class="comment">--对水手表新插入的元组看成一张表</span></span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> STATEMENT                        <span class="comment">--触发行为</span></span><br><span class="line"><span class="keyword">INSERT</span></span><br><span class="line">  <span class="keyword">INTO</span> YoungSailor(sid, name, age, rating)</span><br><span class="line">  <span class="keyword">SELECT</span> sid, name, age, rating</span><br><span class="line">  <span class="keyword">FROM</span> NewSailors N</span><br><span class="line">  <span class="keyword">WHERE</span> N.age <span class="operator">&lt;=</span><span class="number">18</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>触发器的执行策略 </p>
<ul>
<li><p>立即执行【常用】</p>
<ul>
<li>当事件发生时立刻去检查条件是否满足</li>
</ul>
</li>
<li><p>延迟执行</p>
<ul>
<li>等事务要提交时执行</li>
</ul>
</li>
<li><p>分离执行</p>
<ul>
<li>把ECA规则中的动作单独作为一个事务，作为原来事务的衍生事务</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="Chapter-6-数据库设计"><a href="#Chapter-6-数据库设计" class="headerlink" title="Chapter 6 数据库设计"></a>Chapter 6 数据库设计</h1><h2 id="数据依赖"><a href="#数据依赖" class="headerlink" title="数据依赖"></a>数据依赖</h2><ul>
<li><p>函数依赖FD</p>
<ul>
<li>一个属性的值可以决定其他属性的值</li>
</ul>
</li>
<li><p>多值依赖MVD</p>
<ul>
<li>一个属性的值可以决定其他一组值</li>
</ul>
</li>
<li><p>连接依赖JD</p>
<ul>
<li><p>the constraint of lossless join decomposition.</p>
<h2 id="关系模式的规范化"><a href="#关系模式的规范化" class="headerlink" title="关系模式的规范化"></a>关系模式的规范化</h2></li>
</ul>
</li>
<li><p>1NF 一范式</p>
<ul>
<li>关系的属性必须是原子的（意思应该就不能是对象或数组这种）</li>
</ul>
</li>
<li><p>2NF 二范式</p>
<ul>
<li><p>满足一范式</p>
</li>
<li><p>在属性之间没有部分的函数依赖</p>
</li>
<li><p>例子：</p>
<ul>
<li>S(S#, SNAME, AGE, ADDR, C#, GRADE) 不满足2NF，因为知道S#后后面三个值能就确定了</li>
<li>改正：S(S#, SNAME, AGE, ADDR)和SC(S#, C#, GRADE)</li>
</ul>
</li>
<li><p>不满足2范式容易出现的问题： </p>
<ul>
<li>插入异常<ul>
<li>上例中，不能插入一个还未选课的学生的信息</li>
</ul>
</li>
<li>删除异常<ul>
<li>上例中，如果一个学生申请休学，把选过的课退了，那么他的信息也会被删除</li>
</ul>
</li>
<li>更新异常<ul>
<li>更新中难以保持数据的一致性，上例的设计有大量的数据冗余</li>
</ul>
</li>
</ul>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ul>
<li>设计时，一视一地。<ul>
<li>一张表只管一件事情</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>3NF 三范式</p>
<ul>
<li>满足二范式</li>
<li>不存在属性对主键的传递依赖</li>
<li>例子 ：若属性由（职工编号、工资级别、工资）三个属性组成，其中（职工编号）为主键。 </li>
<li>分析：工资取决于工资级别，取决于职工编号</li>
<li>上例不满足3范式的问题 <ul>
<li>插入异常：当一个人的工资级别还没定的时候，他对应的工资也没有</li>
<li>删除异常：若只是删除一个员工的工资信息时，会把对应的工资级别信息也删除了</li>
<li>更新异常：数据内有大量的冗余</li>
</ul>
</li>
<li>解决方法 <ul>
<li>设计时，一视一地。<ul>
<li>一张表只管一件事情</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>4 NF 四范式 </p>
<ul>
<li>在满足三范式的前提下，消除多值依赖。</li>
</ul>
</li>
<li><p>4NF 五范式 </p>
<ul>
<li><p>在满足四范式的前提下，消除连接依赖。</p>
<pre><code>## 数据库设计方法
</code></pre>
</li>
</ul>
</li>
<li><p>面向过程的方法</p>
<ul>
<li>根据单位日常处理的流程，以过程为中心。<ul>
<li>好处<ul>
<li>在设计初期，能比较快的实现</li>
</ul>
</li>
<li>缺点<ul>
<li>没分析数据之间的关系，数据由冗余和矛盾，当流程进行改动时，会有很多问题</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>面向对象的方法</p>
<ul>
<li><p>以数据为中心的方法</p>
</li>
<li><p>分析数据之间的关系，设计一些符合3NF的模式</p>
<h2 id="数据库设计流程"><a href="#数据库设计流程" class="headerlink" title="数据库设计流程"></a>数据库设计流程</h2></li>
</ul>
</li>
</ul>
<ul>
<li><p>需求分析，与用户交流确定需求</p>
</li>
<li><p>概念设计，分析数据之间的关系、实体及实体间的逻辑</p>
</li>
<li><p>逻辑设计，看采用的数据库系统，生成基表</p>
</li>
<li><p>物理设计，考虑数据在内存上到底如何存储</p>
<h2 id="各阶段主要工作"><a href="#各阶段主要工作" class="headerlink" title="各阶段主要工作"></a>各阶段主要工作</h2></li>
</ul>
<ul>
<li><p>需求分析</p>
<ul>
<li>数据字典<ul>
<li>把所有的基本数据元素都找出来<ul>
<li>解决问题：<ul>
<li>名字冲突：同名异意</li>
<li>概念冲突</li>
<li>域冲突</li>
<li>编码问题<ul>
<li>压缩信息</li>
<li>基本信息</li>
<li>实体识别</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>概念设计</p>
<ul>
<li>用ER图抽象出实体</li>
<li>哪些数据项抽象成实体</li>
<li>实体间的联系</li>
<li>相关ER图工具</li>
</ul>
</li>
<li><p>逻辑设计</p>
<ul>
<li>把ER图表达的数据模型进行建表</li>
<li>表和属性的命名规则</li>
<li>逆规范化</li>
<li>定义视图</li>
<li>考虑遗留系统的表的设计</li>
</ul>
</li>
<li><p>物理设计</p>
<ul>
<li><p>根据DBMS特点对每个表的存储和索引情况进行权衡</p>
</li>
<li><p>分区设计</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2></li>
</ul>
</li>
</ul>
<ul>
<li>仅仅在结构上满足3范式是不够的</li>
<li>一事一地包括每项信息的唯一，要提取出问题的本质，识别本质上同一概念的信息项</li>
<li>对于表达类似信息、能合并尽量合并</li>
<li>考虑到效率、用途等因素、该分开的要分开</li>
<li>结合DBMS内部实现技术，合理设计索引和文件结构，为查询优化准备号存取路径</li>
<li>在结构规范化、减少数据冗余和提高数据库访问性能之间仔细权衡，适当折中</li>
</ul>
<p>（勉强整理完了）</p>
</div>
            
           
            <div class="copyright">
                <div class="name">
                    <a>Author:</a>
                    <a>badbao</a>
                </div>
                <div class="link">
                    <a>Link:</a>
                    <a class="permalink" href="https://github.com/thisisbadBao/2021/12/25/db_review/">https://github.com/thisisbadBao/2021/12/25/db_review/</a>
                </div>
                <div class="license">
                    <a>Statement:</a>
                    <a>All articles in this blog shall be licensed by CC BY-NC-SA 3.0 CN, unless otherwise stated. Please indicate the provenance!</a>
                </div>
            </div>
            

          
</article>


<div class="tip">
<button class="tip-btn">
    Tip
</button>
<div class="tip-img">
<ul>
    
<li>
    <img src="/img/alipay.png"></img>
</li>

 
<li>
    <img src="/img/wechatpay.jpg"></img>
</li>

</ul>
</div>
</div>

<div class="more">
  
  <div></div>
  
  <div class="next">
    <a href="/2021/03/05/reading_record/"> 读书(随缘)打卡贴 </a>
  </div>
  
</div>

<div class="bdsharebuttonbox">
<a href="#" class="bds_weixin fa fa-weixin" data-cmd="weixin" title="分享到微信" style="color:#1cbd8f">
</a>
<a href="#" class="bds_tsina fa fa-weibo" data-cmd="tsina" title="分享到新浪微博" style="color:#ff6363">
</a>
<a href="#" class="bds_twi fa fa-twitter" data-cmd="twi" title="分享到Twitter" style="color:#00A7EB">
</a>
<a href="#" class="bds_fbook fa fa-facebook" data-cmd="fbook" title="分享到Facebook" style="color:#00A7EB">
</a>
</div>
<script>
window._bd_share_config={
    "common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"16"},
    "share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='../../../../../static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- <div id="comments"></div>

<script>
    var gitment = new Gitment({
    id: "Sat Dec 25 2021 14:30:06 GMT+0800",
    owner: "Vevlins",
    repo: "Vevlins.github.io",
    oauth: {
      client_id:"8d83609a651e972e308d",
      client_secret: "37e40c89a47e957f654e86f71c5caaccad0774de",
    }
  })
  gitment.render('comments')
</script> -->

    </main>
    <a class="not-found">not found!</a>
    <div class="search-items">
    </div>
    <a href="#header" id="top" style="display:none">
        <i class="fa fa-sort-asc fa-2x"></i>
    </a>
    <footer class="footer">
  <div class="footer-copyright">
    <div>
      ©️2017
      <a href="//github.com/Vevlins/toki" class="link" target="_blank">Toki</a>
      by Vevlins
    </div>
    <div>
      Powered by
      <a href="https://hexo.io/" class="link" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    
<script src="/js/jquery.js"></script>

    
<script src="/js/toki.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>